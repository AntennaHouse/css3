<?xml version="1.0" encoding="UTF-8"?>
<project name="dita2ah-css-pdf" default="dita2ah-css-pdf">

  <condition property="ah-css-pdf.dir" value="plugins${file.separator}ah-css-pdf">
    <not>
      <isset property="ah-css-pdf.dir"/>
    </not>
  </condition>

	<!--
	<target name="dita2ah-css-pdf"
		depends="build-init, preprocess, dita.map.xhtml, copy-revflag, copy-css, 
		dita.topics.xhtml, dita.inner.topics.xhtml, dita.outer.topics.xhtml, ah-css-pdf.copy-css, 
		ah-css-pdf.fix-internal-links, ah-css-pdf.render-to-pdf, ah-css-pdf.clean-output-dir">
	</target>
	-->

	<target name="dita2ah-css-pdf"
		depends="build-init, preprocess, ah-css-pdf.topicmerge">
	</target>

	<target name="ah-css-pdf.topicmerge">
		<dirname file="${dita.temp.dir}${file.separator}${user.input.file}"
			property="dita.merged.dir" />
		<xslt processor="trax" in="${input}"
			out="${dita.merged.dir}${file.separator}${dita.map.filename.root}_MERGED.xml"
			style="${dita.script.dir}${file.separator}topicmerge.xsl">
		</xslt>
	</target>
	
	<target name="ah-css-pdf.copy-css">
		<!-- Copy the plugin's stylesheets to the output directory -->
		<copy todir="${output.dir}${file.separator}css" overwrite="true">
			<fileset dir="${ah-css-pdf.dir}${file.separator}css"/>
		</copy>
	</target>
	
	<target name="ah-css-pdf.fix-internal-links">
		<replace dir="${output.dir}" token=".html" value=".pdf" includes="**/*.html"/>
	</target>
	
	<target name="ah-css-pdf.render-to-pdf">
		<apply executable="AHFCmd" dir="${output.dir}" relative="true" parallel="false" failonerror="true" maxparallel="2">
			<arg value="-d"/>
			<srcfile/>
			<arg value="-o"/>
			<targetfile/>
			<arg value="-extlevel"/>
			<arg value="4"/>
			<fileset dir="${output.dir}" includes="**/*.html"/>
			<mapper type="glob" from="*.html" to="*.pdf"/>
		</apply>
	</target>
	
	<target name="ah-css-pdf.clean-output-dir">
		<delete includeemptydirs="true">
			<fileset dir="${output.dir}">
				<exclude name="**/*.pdf"/>
			</fileset>
		</delete>
	</target>

</project>
